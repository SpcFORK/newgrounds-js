var $=Object.defineProperty;var B=(o,l)=>$(o,"name",{value:l,configurable:!0});function I(o){(function(l,d){typeof exports=="object"?module.exports=exports=d():typeof define=="function"&&define.amd?define([],d):o.CryptoJS=d()})(0,function(){var l=l||function(d,y){var s;if(typeof window!="undefined"&&window.crypto&&(s=window.crypto),!s&&typeof window!="undefined"&&window.msCrypto&&(s=window.msCrypto),!s&&typeof global!="undefined"&&global.crypto&&(s=global.crypto),!s&&typeof require=="function")try{s=require("crypto")}catch(i){}var f=B(function(){if(s){if(typeof s.getRandomValues=="function")try{return s.getRandomValues(new Uint32Array(1))[0]}catch(i){}if(typeof s.randomBytes=="function")try{return s.randomBytes(4).readInt32LE()}catch(i){}}throw new Error("Native crypto module could not be used to get secure random number.")},"i"),m=Object.create||function(){function i(){}return B(i,"t"),function(h){var g;return i.prototype=h,g=new i,i.prototype=null,g}}(),k={},S=k.lib={},_=S.Base={extend:function(i){var h=m(this);return i&&h.mixIn(i),h.hasOwnProperty("init")&&this.init!==h.init||(h.init=function(){h.$super.init.apply(this,arguments)}),h.init.prototype=h,h.$super=this,h},create:function(){var i=this.extend();return i.init.apply(i,arguments),i},init:function(){},mixIn:function(i){for(var h in i)i.hasOwnProperty(h)&&(this[h]=i[h]);i.hasOwnProperty("toString")&&(this.toString=i.toString)},clone:function(){return this.init.prototype.extend(this)}},C=S.WordArray=_.extend({init:function(i,h){i=this.words=i||[],this.sigBytes=h!=null?h:4*i.length},toString:function(i){return(i||Hex).stringify(this)},concat:function(i){var h=this.words,g=i.words,u=this.sigBytes,p=i.sigBytes;if(this.clamp(),u%4)for(var a=0;a<p;a++){var x=g[a>>>2]>>>24-a%4*8&255;h[u+a>>>2]|=x<<24-(u+a)%4*8}else for(a=0;a<p;a+=4)h[u+a>>>2]=g[a>>>2];return this.sigBytes+=p,this},clamp:function(){var i=this.words,h=this.sigBytes;i[h>>>2]&=4294967295<<32-h%4*8,i.length=d.ceil(h/4)},clone:function(){var i=_.clone.call(this);return i.words=this.words.slice(0),i},random:function(i){for(var h=[],g=0;g<i;g+=4)h.push(f());return new C.init(h,i)}}),w=k.enc={},M=w.Latin1={stringify:function(i){for(var h=i.words,g=i.sigBytes,u=[],p=0;p<g;p++){var a=h[p>>>2]>>>24-p%4*8&255;u.push(String.fromCharCode(a))}return u.join("")},parse:function(i){for(var h=i.length,g=[],u=0;u<h;u++)g[u>>>2]|=(255&i.charCodeAt(u))<<24-u%4*8;return new C.init(g,h)}},O=w.Utf8={stringify:function(i){try{return decodeURIComponent(escape(M.stringify(i)))}catch(h){throw new Error("Malformed UTF-8 data")}},parse:function(i){return M.parse(unescape(encodeURIComponent(i)))}};return S.BufferedBlockAlgorithm=_.extend({reset:function(){this._data=new C.init,this._nDataBytes=0},_append:function(i){typeof i=="string"&&(i=O.parse(i)),this._data.concat(i),this._nDataBytes+=i.sigBytes},_process:function(i){var h,g=this._data,u=g.words,p=g.sigBytes,a=this.blockSize,x=p/(4*a),e=(x=i?d.ceil(x):d.max((0|x)-this._minBufferSize,0))*a,r=d.min(4*e,p);if(e){for(var c=0;c<e;c+=a)this._doProcessBlock(u,c);h=u.splice(0,e),g.sigBytes-=r}return new C.init(h,r)},clone:function(){var i=_.clone.call(this);return i._data=this._data.clone(),i},_minBufferSize:0}),k.algo={},k}(Math);return function(){var d=l,y=d.lib.WordArray;d.enc.Base64={stringify:function(s){var f=s.words,m=s.sigBytes,k=this._map;s.clamp();for(var S=[],_=0;_<m;_+=3)for(var C=(f[_>>>2]>>>24-_%4*8&255)<<16|(f[_+1>>>2]>>>24-(_+1)%4*8&255)<<8|f[_+2>>>2]>>>24-(_+2)%4*8&255,w=0;w<4&&_+.75*w<m;w++)S.push(k.charAt(C>>>6*(3-w)&63));var M=k.charAt(64);if(M)for(;S.length%4;)S.push(M);return S.join("")},parse:function(s){var f=s.length,m=this._map,k=this._reverseMap;if(!k){k=this._reverseMap=[];for(var S=0;S<m.length;S++)k[m.charCodeAt(S)]=S}var _=m.charAt(64);if(_){var C=s.indexOf(_);C!==-1&&(f=C)}return function(w,M,O){for(var i=[],h=0,g=0;g<M;g++)if(g%4){var u=O[w.charCodeAt(g-1)]<<g%4*2,p=O[w.charCodeAt(g)]>>>6-g%4*2,a=u|p;i[h>>>2]|=a<<24-h%4*8,h++}return y.create(i,h)}(s,f,k)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),l.lib.Cipher||function(d){var y=l,s=y.lib,f=s.Base,m=s.WordArray,k=s.BufferedBlockAlgorithm,S=y.enc,_=(S.Utf8,S.Base64),C=y.algo.EvpKDF,w=s.Cipher=k.extend({cfg:f.extend(),createEncryptor:function(e,r){return this.create(this._ENC_XFORM_MODE,e,r)},createDecryptor:function(e,r){return this.create(this._DEC_XFORM_MODE,e,r)},init:function(e,r,c){this.cfg=this.cfg.extend(c),this._xformMode=e,this._key=r,this.reset()},reset:function(){k.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(r){return typeof r=="string"?x:p}return B(e,"t"),function(r){return{encrypt:function(c,t,n){return e(t).encrypt(r,c,t,n)},decrypt:function(c,t,n){return e(t).decrypt(r,c,t,n)}}}}()}),M=(s.StreamCipher=w.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),y.mode={}),O=s.BlockCipherMode=f.extend({createEncryptor:function(e,r){return this.Encryptor.create(e,r)},createDecryptor:function(e,r){return this.Decryptor.create(e,r)},init:function(e,r){this._cipher=e,this._iv=r}}),i=M.CBC=function(){var e=O.extend();function r(c,t,n){var v,b=this._iv;b?(v=b,this._iv=d):v=this._prevBlock;for(var D=0;D<n;D++)c[t+D]^=v[D]}return B(r,"r"),e.Encryptor=e.extend({processBlock:function(c,t){var n=this._cipher,v=n.blockSize;r.call(this,c,t,v),n.encryptBlock(c,t),this._prevBlock=c.slice(t,t+v)}}),e.Decryptor=e.extend({processBlock:function(c,t){var n=this._cipher,v=n.blockSize,b=c.slice(t,t+v);n.decryptBlock(c,t),r.call(this,c,t,v),this._prevBlock=b}}),e}(),h=(y.pad={}).Pkcs7={pad:function(e,r){for(var c=4*r,t=c-e.sigBytes%c,n=t<<24|t<<16|t<<8|t,v=[],b=0;b<t;b+=4)v.push(n);var D=m.create(v,t);e.concat(D)},unpad:function(e){var r=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=r}},g=(s.BlockCipher=w.extend({cfg:w.cfg.extend({mode:i,padding:h}),reset:function(){var e;w.reset.call(this);var r=this.cfg,c=r.iv,t=r.mode;this._xformMode==this._ENC_XFORM_MODE?e=t.createEncryptor:(e=t.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,c&&c.words):(this._mode=e.call(t,this,c&&c.words),this._mode.__creator=e)},_doProcessBlock:function(e,r){this._mode.processBlock(e,r)},_doFinalize:function(){var e,r=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(r.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),r.unpad(e)),e},blockSize:4}),s.CipherParams=f.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),u=(y.format={}).OpenSSL={stringify:function(e){var r=e.ciphertext,c=e.salt;return(c?m.create([1398893684,1701076831]).concat(c).concat(r):r).toString(_)},parse:function(e){var r,c=_.parse(e),t=c.words;return t[0]==1398893684&&t[1]==1701076831&&(r=m.create(t.slice(2,4)),t.splice(0,4),c.sigBytes-=16),g.create({ciphertext:c,salt:r})}},p=s.SerializableCipher=f.extend({cfg:f.extend({format:u}),encrypt:function(e,r,c,t){t=this.cfg.extend(t);var n=e.createEncryptor(c,t),v=n.finalize(r),b=n.cfg;return g.create({ciphertext:v,key:c,iv:b.iv,algorithm:e,mode:b.mode,padding:b.padding,blockSize:e.blockSize,formatter:t.format})},decrypt:function(e,r,c,t){return t=this.cfg.extend(t),r=this._parse(r,t.format),e.createDecryptor(c,t).finalize(r.ciphertext)},_parse:function(e,r){return typeof e=="string"?r.parse(e,this):e}}),a=(y.kdf={}).OpenSSL={execute:function(e,r,c,t){t||(t=m.random(8));var n=C.create({keySize:r+c}).compute(e,t),v=m.create(n.words.slice(r),4*c);return n.sigBytes=4*r,g.create({key:n,iv:v,salt:t})}},x=s.PasswordBasedCipher=p.extend({cfg:p.cfg.extend({kdf:a}),encrypt:function(e,r,c,t){var n=(t=this.cfg.extend(t)).kdf.execute(c,e.keySize,e.ivSize);t.iv=n.iv;var v=p.encrypt.call(this,e,r,n.key,t);return v.mixIn(n),v},decrypt:function(e,r,c,t){t=this.cfg.extend(t),r=this._parse(r,t.format);var n=t.kdf.execute(c,e.keySize,e.ivSize,r.salt);return t.iv=n.iv,p.decrypt.call(this,e,r,n.key,t)}})}(),function(){var d=l,y=d.lib.BlockCipher,s=d.algo,f=[],m=[],k=[],S=[],_=[],C=[],w=[],M=[],O=[],i=[];(function(){for(var u=[],p=0;p<256;p++)u[p]=p<128?p<<1:p<<1^283;var a=0,x=0;for(p=0;p<256;p++){var e=x^x<<1^x<<2^x<<3^x<<4;e=e>>>8^255&e^99,f[a]=e,m[e]=a;var r=u[a],c=u[r],t=u[c],n=257*u[e]^16843008*e;k[a]=n<<24|n>>>8,S[a]=n<<16|n>>>16,_[a]=n<<8|n>>>24,C[a]=n,n=16843009*t^65537*c^257*r^16843008*a,w[e]=n<<24|n>>>8,M[e]=n<<16|n>>>16,O[e]=n<<8|n>>>24,i[e]=n,a?(a=r^u[u[u[t^r]]],x^=u[u[x]]):a=x=1}})();var h=[0,1,2,4,8,16,32,64,128,27,54],g=s.AES=y.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var u=this._keyPriorReset=this._key,p=u.words,a=u.sigBytes/4,x=4*((this._nRounds=a+6)+1),e=this._keySchedule=[],r=0;r<x;r++)r<a?e[r]=p[r]:(n=e[r-1],r%a?a>6&&r%a==4&&(n=f[n>>>24]<<24|f[n>>>16&255]<<16|f[n>>>8&255]<<8|f[255&n]):(n=f[(n=n<<8|n>>>24)>>>24]<<24|f[n>>>16&255]<<16|f[n>>>8&255]<<8|f[255&n],n^=h[r/a|0]<<24),e[r]=e[r-a]^n);for(var c=this._invKeySchedule=[],t=0;t<x;t++){if(r=x-t,t%4)var n=e[r];else n=e[r-4];c[t]=t<4||r<=4?n:w[f[n>>>24]]^M[f[n>>>16&255]]^O[f[n>>>8&255]]^i[f[255&n]]}}},encryptBlock:function(u,p){this._doCryptBlock(u,p,this._keySchedule,k,S,_,C,f)},decryptBlock:function(u,p){var a=u[p+1];u[p+1]=u[p+3],u[p+3]=a,this._doCryptBlock(u,p,this._invKeySchedule,w,M,O,i,m),a=u[p+1],u[p+1]=u[p+3],u[p+3]=a},_doCryptBlock:function(u,p,a,x,e,r,c,t){for(var n=this._nRounds,v=u[p]^a[0],b=u[p+1]^a[1],D=u[p+2]^a[2],E=u[p+3]^a[3],z=4,j=1;j<n;j++){var A=x[v>>>24]^e[b>>>16&255]^r[D>>>8&255]^c[255&E]^a[z++],R=x[b>>>24]^e[D>>>16&255]^r[E>>>8&255]^c[255&v]^a[z++],T=x[D>>>24]^e[E>>>16&255]^r[v>>>8&255]^c[255&b]^a[z++],P=x[E>>>24]^e[v>>>16&255]^r[b>>>8&255]^c[255&D]^a[z++];v=A,b=R,D=T,E=P}A=(t[v>>>24]<<24|t[b>>>16&255]<<16|t[D>>>8&255]<<8|t[255&E])^a[z++],R=(t[b>>>24]<<24|t[D>>>16&255]<<16|t[E>>>8&255]<<8|t[255&v])^a[z++],T=(t[D>>>24]<<24|t[E>>>16&255]<<16|t[v>>>8&255]<<8|t[255&b])^a[z++],P=(t[E>>>24]<<24|t[v>>>16&255]<<16|t[b>>>8&255]<<8|t[255&D])^a[z++],u[p]=A,u[p+1]=R,u[p+2]=T,u[p+3]=P},keySize:8});d.AES=y._createHelper(g)}(),l})}B(I,"setCrypto");function F(o,l=0,d={}){var k,S,_,C,w,M,O;this.appID=o,this.cipher=l,I(this),this.medalDisplayTime=d.medalDisplayTime||5,this.showPopups=d.showPopups||!0,this.showDescriptions=d.showDescriptions||!0,this.debug=d.debug||!1,this.points=[5,10,25,50,100],this.displayMedalQueue=[];let s=new URL(window.location.href);this.sessionID=(k=s.searchParams.get("ngio_session_id"))!=null?k:0;let f=this.call("ScoreBoard.getBoards",0,0);this.scoreboards=(C=(_=(S=f==null?void 0:f.result)==null?void 0:S.data)==null?void 0:_.scoreboards)!=null?C:[];let m=this.call("Medal.getList",0,0);this.medals=(O=(M=(w=m==null?void 0:m.result)==null?void 0:w.data)==null?void 0:M.medals)!=null?O:[];for(let i of this.medals)i.image=new Image,i.image.src=i.icon,this.debug&&(i.unlocked=0)}B(F,"connect");function J(o){if(!this.medals||!this.medals.find(d=>d.id==o))return;let l=this.medals.find(d=>d.id==o);l.unlocked||(l.unlocked=!0,this.call("Medal.unlock",{id:l.id}))}B(J,"unlockMedal");function N(o){return unescape(o.name+" ("+this.points[o.difficulty-1]+")"+(this.showDescriptions?" - "+o.description:""))}B(N,"getMedalText");function L(o,l=0,d="A",y=0,s=0,f=10){var S,_;if(!this.scoreboards||!this.scoreboards.find(C=>C.id==o))return;let m=this.scoreboards.find(C=>C.id==o);return(_=(S=this.call("ScoreBoard.getScores",{id:m.id,user:l,period:d,social:y,skip:s,limit:f},0).result)==null?void 0:S.data)==null?void 0:_.scores}B(L,"getScores");function U(o,l){if(!this.scoreboards||!this.scoreboards.find(y=>y.id==o))return;let d=this.scoreboards.find(y=>y.id==o);this.call("ScoreBoard.postScore",{id:d.id,value:l})}B(U,"postScore");function G(o,l,d,y,s,f=.5){if(!this.medals||!this.medals.find(_=>_.id==l))return;o.save(),o.fillStyle="#fff",o.strokeStyle="#000",o.shadowColor="#000",o.textBaseline="middle",o.textAlign="left",o.font=s/2+"px impact",o.lineWidth=s/35,o.shadowBlur=s/5,o.globalAlpha=f;let m=this.medals.find(_=>_.id==l);o.drawImage(m.image,d,y,s,s),o.strokeRect(d,y,s,s);let k=this.points[m.difficulty-1],S=this.getMedalText(m);o.lineWidth=Math.max(1,s/26),o.strokeText(S,d+s*1.2,y+s/2),o.fillText(S,d+s*1.2,y+s/2),o.restore()}B(G,"renderMedal");function X(o){var l;if((l=this.displayMedalQueue)==null?void 0:l.length){let d=this.displayMedalQueue[0];d.time+=o,d.time>this.medalDisplayTime&&this.displayMedalQueue.shift()}}B(X,"update");function Q(o,l=50){var d;if((d=this.displayMedalQueue)==null?void 0:d.length){let y=this.displayMedalQueue[0],s=y.time<1?1-y.time:0,f=y.time>this.medalDisplayTime-1?this.medalDisplayTime-y.time:1,m=o.canvas.height+s*l*1.5;G(o,y.index,0,m-l,l,f)}}B(Q,"render");function W(){var l,d,y,s;let o=this.call("App.checkSession");return(s=(y=(d=(l=o==null?void 0:o.result)==null?void 0:l.data)==null?void 0:d.session)==null?void 0:y.user)==null?void 0:s.name}B(W,"username");function H(){var l,d;let o=this.call("App.getCurrentVersion");return(d=(l=o==null?void 0:o.result)==null?void 0:l.data)==null?void 0:d.current_version}B(H,"version");function K(){var l,d,y,s;let o=this.call("App.checkSession");return(s=(y=(d=(l=o==null?void 0:o.result)==null?void 0:l.data)==null?void 0:d.session)==null?void 0:y.user)==null?void 0:s.supporter}B(K,"isSupporter");function q(o){if(!this.cipher)return o;let l=this.CryptoJS.enc.Base64.parse(this.cipher),d=this.CryptoJS.lib.WordArray.random(16),y=this.CryptoJS.AES.encrypt(JSON.stringify(o),l,{iv:d}),s=this.CryptoJS.enc.Base64.stringify(d.concat(y.ciphertext));return o.secure=s,o.parameters=null,o}B(q,"encryptCall");function V(o,l=0,d=1){let y=this.encryptCall({component:o,parameters:l}),s={app_id:this.appID,session_id:this.sessionID,call:y},f=new FormData;f.append("input",JSON.stringify(s));let m=new XMLHttpRequest,k="https://newgrounds.io/gateway_v3.php";if(m.open("POST",k,this.debug?0:d),m.send(f),m.responseText)return this.debug&&console.log(m.responseText),this.responseText=m.responseText,JSON.parse(m.responseText)}B(V,"call");var Y={connect:F,unlockMedal:J,getMedalText:N,getScores:L,postScore:U,update:X,render:Q,username:W,version:H,isSuporter:K,call:V,encryptCall:q};module.exports=Y;
